#!/usr/bin/env bash

echo "Broadcasting (with auto gas approximation)..."
TX='{"mode":"block","tx":"0x7B227061796C6F6164223A5B7B2274797065223A226469642F416464446964222C2276616C7565223A7B22646964446F63223A7B22646964223A226469643A69786F3A34584A4C426647745753474B537A344265527864756E222C227075624B6579223A2232764D4868737364687242435246697139766A37547847594479625734795964725968394A47353652614174222C2263726564656E7469616C73223A6E756C6C7D7D7D5D2C227369676E617475726573223A5B7B227369676E617475726556616C7565223A22505A73504A526C4E422B787349786A3530656F3157723858376C664448575252594F424565775830345934623039793875382B676C4F7955586E585074535650612F55654E677830532B4679396E2B6D336D624343413D3D222C2263726561746564223A22323032302D30362D31315431333A35343A32332E3738395A227D5D7D"}'
curl -X POST localhost:1317/txs_auto_gas --data-binary "$TX"

echo ""

echo "Now we can query the DID..."
curl -X GET localhost:1317/did/did:ixo:4XJLBfGtWSGKSz4BeRxdun

# Decoded transaction (what we're actually broadcasting):
# {
#   "payload": [
#     {
#       "type": "did/AddDid",
#       "value": {
#         "didDoc": {
#           "did": "did:ixo:4XJLBfGtWSGKSz4BeRxdun",
#           "pubKey": "2vMHhssdhrBCRFiq9vj7TxGYDybW4yYdrYh9JG56RaAt",
#           "credentials": null
#         }
#       }
#     }
#   ],
#   "signatures": [
#     {
#       "signatureValue": "PZsPJRlNB+xsIxj50eo1Wr8X7lfDHWRRYOBEewX04Y4b09y8u8+glOyUXnXPtSVPa/UeNgx0S+Fy9n+m3mbCCA==",
#       "created": "2020-06-11T13:51:33.021Z"
#     }
#   ]
# }
